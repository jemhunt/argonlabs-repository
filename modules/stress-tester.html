<div id="page-stress-tester" class="page-content">
    <header class="page-header">
        <h1>AI Document Stress Tester</h1>
        <p>Analyse document resilience against multiple adverse scenarios.</p>
    </header>

    <div id="errorDisplay" class="error-message" style="display:none;"></div>

    <div class="panel">
        <h2><div>Configuration<small>Set up the API key, model, and analysis parameters</small></div></h2>
        <div class="two-columns">
            <div class="form-group">
                <label for="apiKey">OpenAI API Key:</label>
                <input type="password" id="apiKey" placeholder="Enter your OpenAI API Key (e.g. sk-...)">
            </div>
            <div class="form-group">
                <label for="apiModel">Select Model (for main analysis):</label>
                <select id="apiModel"></select>
            </div>
        </div>
         <div class="two-columns">
            <div class="form-group">
                <label for="analysisStages">Analysis Stages per Scenario:</label>
                <select id="analysisStages">
                    <option value="1" selected>1 (Base Analysis Only)</option>
                    <option value="2">2 (Base + 1 QA Stage)</option>
                    <option value="3">3 (Base + 2 QA Stages)</option>
                    <option value="4">4 (Base + 3 QA Stages)</option>
                    <option value="5">5 (Base + 4 QA Stages)</option>
                    <option value="6">6 (Base + 5 QA Stages)</option>
                    <option value="7">7 (Base + 6 QA Stages)</option>
                    <option value="8">8 (Base + 7 QA Stages)</option>
                    <option value="9">9 (Base + 8 QA Stages)</option>
                    <option value="10">10 (Base + 9 QA Stages)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="runsPerStage">Simultaneous AI Runs per Stage:</label>
                <select id="runsPerStage">
                    <option value="1" selected>1 (Faster)</option>
                    <option value="2">2</option>
                    <option value="3">3 (More Robust)</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="audExchangeRate">USD to AUD Exchange Rate (e.g. 1.50):</label>
            <input type="number" id="audExchangeRate" value="1.50" step="0.01" style="width: auto; min-width: 150px;">
        </div>
    </div>

    <div class="panel">
        <h2><div>Document Input<small>Upload a document and provide context</small></div></h2>
        <div class="form-group">
            <label for="docFile">Upload Document (PDF, DOCX, TXT):</label>
            <input type="file" id="docFile" accept=".pdf,.docx,.txt">
            <div id="fileInfo" class="file-info">No file selected.</div>
        </div>
         <div class="form-group">
            <label for="areaOfPractice">Area of Practice (for context):</label>
            <select id="areaOfPractice">
                <option value="">Select an area...</option>
                <option value="Commercial & Business Law">Commercial & Business Law</option>
                <option value="Property Law">Property Law</option>
                <option value="Employment Law">Employment Law</option>
                <option value="Litigation & Dispute Resolution">Litigation & Dispute Resolution</option>
                <option value="Wills & Estates">Wills & Estates</option>
                <option value="Mergers & Acquisitions">Mergers & Acquisitions</option>
                <option value="Other">Other</option>
            </select>
        </div>
        <div class="form-group" id="otherAreaOfPracticeGroup" style="display:none;">
            <label for="otherAreaOfPracticeText">Specify "Other" Area of Practice:</label>
            <input type="text" id="otherAreaOfPracticeText" placeholder="e.g. Maritime Law, Intellectual Property">
        </div>
    </div>

    <div class="panel">
        <h2><div>Stress Test Scenarios<small>Define what-if scenarios to test against</small></div></h2>
        <div class="scenario-generation-controls">
             <label for="numScenariosToGenerate">Number of Scenarios to Generate:</label>
             <input type="number" id="numScenariosToGenerate" value="5" min="1" max="20">
             <button id="suggestScenariosBtn" onclick="generateScenariosWithAI()" class="button-secondary">
                <span class="button-spinner" id="suggestBtnSpinner"></span>
                <span class="button-text" id="suggestBtnText">Suggest with AI</span>
            </button>
        </div>
        <div class="form-group">
            <label for="scenarios">Enter Scenarios (one per line) or use AI Suggestion:</label>
            <textarea id="scenarios" placeholder="e.g. What if a key party becomes insolvent?
What if there's a significant change in relevant legislation?
What if a force majeure event occurs?"></textarea>
        </div>
        <button onclick="clearScenarios()" class="button-secondary" style="font-size:0.9em; padding: 8px 12px;">Clear Scenarios</button>
    </div>

    <div class="panel">
        <button id="stressTestBtn" onclick="stressTestDocument()">
            <span class="button-spinner" id="btnSpinner"></span>
            <span class="button-text" id="btnText">Run Stress Test</span>
        </button>
        <button id="stopStressTestBtn" onclick="requestStopProcess()" style="display:none; background-color: var(--argon-error-color);">
            Stop Process
        </button>

        <div class="loading-indicator" id="loadingIndicator">
             <p id="loadingMessage">Processing...</p>
             <div id="progressLog"></div>
        </div>
    </div>

    <div id="resultsPanel" class="panel" style="display:none;">
        <h2><div>Analysis Results<small>Consolidated findings from all test runs</small></div></h2>
        <!-- All results sub-panels will be generated here by JS -->
    </div>
    
    <div id="usageStatsPanel" class="panel" style="display:none;">
        <h2><div>Usage Statistics<small>Estimated token usage and cost for the analysis</small></div></h2>
        <!-- Usage stats will be generated here by JS -->
    </div>

    <div id="revisedDocumentPanel" class="panel" style="display:none;">
        <h2><div>AI-Drafted Document Revision (Experimental)<small>A draft revision based on recommendations</small></div></h2>
        <!-- Revision tool will be generated here by JS -->
    </div>
    
    <!-- This hidden element is used for PDF generation -->
    <div id="pdfReportContentTemplate" style="display: none;"></div>
</div>